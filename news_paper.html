<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <script>
        (function() {
            const currentHost = window.location.hostname;
            const cfHost = 'aurora-project.pages.dev';
            const appHost = 'helloroom123-github-io.vercel.app';

            if (currentHost === cfHost || currentHost === appHost || currentHost === 'localhost' || currentHost === '127.0.0.1') return;

            let redirected = false;

            function check(host) {
                return new Promise(r => {
                    const img = new Image();
                    img.onload = () => r(true);
                    img.onerror = () => r(false);
                    setTimeout(() => r(false), 2000); 
                    img.src = 'https://' + host + '/assets/img/avatar/penguin.png?t=' + Date.now();
                });
            }

            // Country Check
            fetch('https://api.country.is')
                .then(res => res.json())
                .then(data => {
                    if (data.country === 'CN' && !redirected) {
                        redirected = true;
                        window.location.href = 'https://' + cfHost + window.location.pathname + window.location.search + window.location.hash;
                    }
                })
                .catch(e => {});

            check(cfHost).then(isCfOk => {
                if (redirected) return;
                if (isCfOk) {
                    redirected = true;
                    window.location.href = 'https://' + cfHost + window.location.pathname + window.location.search + window.location.hash;
                } else {
                    check(appHost).then(isVercelOk => {
                        if (redirected) return;
                        if (isVercelOk) {
                            redirected = true;
                            window.location.href = 'https://' + appHost + window.location.pathname + window.location.search + window.location.hash;
                        } else {
                            document.addEventListener('DOMContentLoaded', () => {
                                const n = document.createElement('div');
                                n.style.cssText = 'position:fixed;top:0;left:0;width:100%;background:rgba(200,0,0,0.9);color:#fff;text-align:center;padding:5px;z-index:999999;font-size:12px;backdrop-filter:blur(5px);';
                                n.innerHTML = 'âš ï¸ ç½‘ç»œèŠ‚ç‚¹è¿æ¥å¤±è´¥ï¼Œå·²ä¿ç•™åœ¨ GitHub Pagesã€‚';
                                document.body.prepend(n);
                            });
                        }
                    });
                }
            });
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æå…‰è®¡åˆ’æ¯æ—¥æ–°é—» Aurora Daily - è®°å½•å…±åˆ›ç‚¹æ»´</title>
    <link rel="icon" href="assets/img/avatar/penguin.png" type="image/png">
    <link rel="stylesheet" href="style.css?v=8">
    <script src="assets/js/config.js"></script>
</head>
<body class="newspaper-body">
    
    <script type="module">
        import { supabase } from './assets/js/supabase.js';

        // Load News from Supabase
        async function loadDynamicNews() {
            // Update Date
            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
            const metaDiv = document.querySelector('.paper-meta');
            if (metaDiv) {
                 metaDiv.innerHTML = `<span>VOL. 01</span><span>${dateStr}</span><span>å®šä»·ï¼šå…è´¹</span>`;
            }

            console.log('Fetching news from Supabase...');
            const { data, error } = await supabase
                .from('news_articles')
                .select('*')
                .order('created_at', { ascending: false })
                .limit(10); // å¢åŠ æ•°é‡

            if (error) {
                console.error('Error loading news:', error);
                // å¯ä»¥åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºä¸€ä¸ªå°çš„é”™è¯¯æç¤º
                return;
            }

            console.log('News data received:', data);

            if (data && data.length > 0) {
                // 1. Populate Ticker
                const tickerContent = document.getElementById('ticker-content');
                if (tickerContent) {
                    const titles = data.slice(0, 5).map(n => `<span>[${n.category || 'NEWS'}] ${n.title}</span>`).join('<span class="ticker-sep">+++</span>');
                    // Duplicate content to ensure smooth scrolling loop
                    tickerContent.innerHTML = titles + '<span class="ticker-sep">+++</span>' + titles + '<span class="ticker-sep">+++</span>' + titles;
                }

                const container = document.querySelector('.paper-grid');
                // The static hero is the first child
                const staticHero = container.querySelector('.hero-article');
                
                // 2. Check for HEADLINE
                const headlineNews = data.find(n => n.category === 'HEADLINE');
                
                // 3. Filter out the headline from the regular list if it exists
                // If no headline found, we show all news below static hero
                const regularNews = headlineNews ? data.filter(n => n.id !== headlineNews.id) : data;

                // 4. Update Hero if HEADLINE exists
                if (headlineNews && staticHero) {
                     const dateObj = new Date(headlineNews.created_at);
                     const date = isNaN(dateObj.getTime()) ? 'åˆšåˆš' : dateObj.toLocaleDateString('zh-CN');
                     
                     // Replace static content with dynamic headline
                     staticHero.innerHTML = `
                        <div class="article-inner">
                            <span class="article-tag" style="background:#e60012; color:#fff;">å¤´æ¡ / HEADLINE</span>
                            <h2>${headlineNews.title}</h2>
                            <div class="article-img">
                                ${headlineNews.image_url ? `<img src="${headlineNews.image_url}" class="hero-image" style="width:100%; object-fit:cover;">` : ''}
                                <span class="caption">${date} Â· ç¼–è¾‘ç²¾é€‰</span>
                            </div>
                            <div class="article-content">
                                <p class="drop-cap" style="font-family:serif;">${headlineNews.content.charAt(0)}</p>
                                <p>${headlineNews.content.slice(1)}</p>
                            </div>
                        </div>
                     `;
                }

                // 5. Render remaining news
                regularNews.forEach(news => {
                    const article = document.createElement('article');
                    article.className = 'paper-article';
                    
                    // æ ¼å¼åŒ–æ—¥æœŸ
                    const dateObj = new Date(news.created_at);
                    const date = isNaN(dateObj.getTime()) ? 'åˆšåˆš' : dateObj.toLocaleDateString('zh-CN');
                    
                    // åˆ¤æ–­æ˜¯å¦æœ‰å›¾ç‰‡
                    const hasImage = !!news.image_url;

                    article.innerHTML = `
                        <div class="article-inner" style="display:flex; flex-direction:column; height:100%;">
                            <span class="article-tag" style="background:#333;color:#fff;">${news.category || 'NEWS'}</span>
                            <h3 style="margin:10px 0;">${news.title}</h3>
                            ${hasImage ? `<img src="${news.image_url}" style="width:100%;height:150px;object-fit:cover;margin-bottom:10px;border:1px solid #eee;" onerror="this.style.display='none'">` : ''}
                            <div class="article-content" style="${hasImage ? 'max-height: 100px; overflow: hidden; text-overflow: ellipsis;' : 'flex: 1; overflow: visible;'}">
                                <p style="font-size:0.9rem; line-height:1.6; color:#444;">${news.content}</p>
                            </div>
                            <small style="margin-top:auto;padding-top:10px;color:#999;display:block;border-top:1px solid #eee;">${date}</small>
                        </div>
                    `;
                    
                    // Insert dynamic news after hero
                    // Note: If we replaced hero content, staticHero element is still there, just with new innerHTML
                    // So we can still use it as reference point
                    staticHero.after(article);
                });
            } else {
                console.log('No news found.');
                const tickerContent = document.getElementById('ticker-content');
                if(tickerContent) tickerContent.innerHTML = "æš‚æ— æœ€æ–°æ¶ˆæ¯ / No News Available";
            }
        }

        loadDynamicNews();
    </script>

    <!-- Sidebar Overlay -->
    <div id="sidebar-overlay">
        <div class="sidebar-header">
            <h3>æŠ•ç¨¿ / SUBMIT FANART</h3>
            <button class="close-sidebar-btn" onclick="toggleSidebar()">Ã—</button>
        </div>
        <div class="sidebar-content">
            <p style="margin-bottom: 20px; font-size: 0.9rem; color: #666;">æ¬¢è¿å‘ Aurora Project æŠ•ç¨¿åŒäººä½œå“ï¼æ‚¨çš„ä½œå“å¯èƒ½ä¼šè¢«å±•ç¤ºåœ¨ Fanart é¡µé¢ã€‚</p>
            
            <form id="fanart-form" onsubmit="handleFanartSubmit(event)">
                <div class="sidebar-form-group">
                    <label>æ˜µç§° / Name</label>
                    <input type="text" placeholder="æ‚¨çš„ç§°å‘¼" required>
                </div>
                
                <div class="sidebar-form-group">
                    <label>ä½œå“æ ‡é¢˜ / Title</label>
                    <input type="text" placeholder="ä½œå“æ ‡é¢˜">
                </div>

                <div class="sidebar-form-group">
                    <label>ä½œå“æ–‡ä»¶ / File</label>
                    <input type="file" accept="image/*" required>
                </div>

                <div class="sidebar-form-group">
                    <label>ç•™è¨€ / Comment</label>
                    <textarea placeholder="æƒ³å¯¹ Aurora è¯´çš„è¯..."></textarea>
                </div>

                <button type="submit" class="submit-btn">æäº¤ / SUBMIT</button>
            </form>
        </div>
    </div>

    <nav class="navbar">
        <div class="logo" onclick="toggleSidebar()">èˆ’è‹’ AURORA</div>
        <div class="nav-links">
            <a href="index.html#home">TOP</a>
            <a href="news_paper.html" class="active">NEWS</a>
            <a href="index.html#profile">CHARACTER</a>
            <a href="index.html#story">STORY</a>
            <a href="index.html#credits">CREDITS</a>
            <a href="qa.html">Q&A</a>
            <a href="staff_oc.html">STAFF OC</a>
            <a href="index.html#join">JOIN</a>
            <a href="fanart.html">FANART</a>
            <a href="ç“¦ç‹—97.html" style="color: #e60012;">GAME</a>
        </div>
    </nav>

    <div class="paper-container">
        <!-- Newspaper Header -->
        <header class="paper-header">
            <div class="paper-meta">
                <span>VOL. 01</span>
                <span>2026å¹´1æœˆ17æ—¥ æ˜ŸæœŸå…­</span>
                <span>å®šä»·ï¼šå…è´¹</span>
            </div>
            <h1 class="paper-title">Aurora Daily</h1>
            <div class="paper-subtitle">æå…‰è®¡åˆ’æ¯æ—¥æ–°é—» Â· è®°å½•å…±åˆ›ç‚¹æ»´</div>
            <div class="header-line"></div>
        </header>

        <!-- Breaking News Ticker -->
        <div class="news-ticker">
            <div class="ticker-content" id="ticker-content">
                Loading latest news...
            </div>
        </div>

        <!-- Grid Content -->
        <div class="paper-grid">
            
            <!-- Hero Article (Large) -->
            <article class="paper-article hero-article">
                <div class="article-inner">
                    <span class="article-tag">å¤´æ¡ / HEADLINE</span>
                    <h2>Aurora ç½‘ç«™æ¶æ„å…¨é¢å‡çº§ï¼</h2>
                    <div class="article-img">
                        <img src="assets/img/character_full.png" alt="Aurora" class="hero-image">
                        <span class="caption">æ›´ç¨³ã€æ›´å¿«ã€æ›´å¼ºçš„æå…‰ä½“éªŒ</span>
                    </div>
                    <div class="article-content">
                        <p class="drop-cap">W</p>
                        <p>e have evolved. ä¼åˆ’ç»„ä»Šæ—¥å®£å¸ƒï¼ŒAurora å®˜æ–¹ç½‘ç«™å·²å®Œæˆå²è¯—çº§æ¶æ„è¿ç§»ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬çš„å‰ç«¯è¿è¡Œåœ¨ Cloudflare å…¨çƒè¾¹ç¼˜ç½‘ç»œï¼Œåç«¯ç”± Serverless æ— æœåŠ¡å™¨æŠ€æœ¯é©±åŠ¨ï¼Œå¹¶æ¥å…¥äº† Catbox é«˜é€Ÿå›¾åºŠã€‚</p>
                        <p>è¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿæ„å‘³ç€æ— è®ºä½ åœ¨ä¸–ç•Œçš„å“ªä¸ªè§’è½ï¼Œè®¿é—®é€Ÿåº¦éƒ½å°†å¤§å¹…æå‡ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¼•å…¥äº†æ™ºèƒ½é™æµä¸åçˆ¬è™«æœºåˆ¶ï¼Œç¡®ä¿æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p>
                        <p>æ­¤å¤–ï¼Œå…¨æ–°çš„â€œåŠ¨æ€æ–°é—»ç³»ç»Ÿâ€å·²ä¸Šçº¿ï¼Œæœªæ¥åˆ¶ä½œç»„å°†é€šè¿‡æ‰‹æœºç›´æ¥æ¨é€æœ€æ–°æƒ…æŠ¥ï¼</p>
                    </div>
                </div>
            </article>

            <!-- Old Hero as Secondary -->
            <article class="paper-article" style="grid-column: span 2;">
                <div class="article-inner">
                    <span class="article-tag">å›é¡¾ / ARCHIVE</span>
                    <h3>Aurora å®˜æ–¹ç½‘ç«™æ­£å¼ä¸Šçº¿</h3>
                    <p>Aurora Project ä¼åˆ’ç»„æ­¤å‰å®£å¸ƒèˆ’è‹’ (Aurora) çš„å®˜æ–¹å®£ä¼ ç½‘ç«™å…¨é¢ä¸Šçº¿ã€‚ç½‘ç«™é‡‡ç”¨äº†ç‹¬ç‰¹çš„ç¿¡ç¿ ç»¿é…è‰²ï¼Œå®Œç¾å¥‘åˆè§’è‰²çš„ä»£è¡¨è‰²ã€‚</p>
                </div>
            </article>

            <!-- Vertical Sidebar Article -->
            <article class="paper-article vertical-col">
                <div class="article-inner">
                    <h3>ç½‘ç«™æ›´æ–°æ—¥å¿—</h3>
                    <div class="log-list">
                        <div class="log-item">
                            <span class="date">1.17</span>
                            <p>æ–°å¢â€œAurora Dailyâ€æ–°é—»æŠ¥çº¸é¡µé¢ã€‚</p>
                        </div>
                        <div class="log-item">
                            <span class="date">1.17</span>
                            <p>å®è£…äº†ç§»åŠ¨ç«¯é€‚é…ä¸æ‰‹ç”µç­’äº¤äº’åŠŸèƒ½ã€‚</p>
                        </div>
                        <div class="log-item">
                            <span class="date">1.17</span>
                            <p>ä¿®å¤äº†å®£ä¼ å›¾åŠ è½½é—®é¢˜ï¼Œå¹¶å¢åŠ äº†â€œä¸æ”¯æŒâ€æŒ‰é’®çš„æƒŠå–œæ•ˆæœã€‚</p>
                        </div>
                        <div class="log-item">
                            <span class="date">1.17</span>
                            <p>Staff é¡µé¢æ–°å¢ä¼é¹… Wiki æ¶æè¯æ¡ã€‚</p>
                        </div>
                    </div>
                </div>
            </article>

            <!-- Small Box -->
            <article class="paper-article small-box">
                <div class="article-inner">
                    <h3>ä»Šæ—¥å¤©æ°”</h3>
                    <p style="font-size: 2rem; text-align: center; margin: 10px 0;">ğŸŒ¤ï¸</p>
                    <p style="text-align: center;">ä¼åˆ’ç¾¤å†…æ°”æ°›æ´»è·ƒ<br>é€‚åˆæ‘¸é±¼</p>
                </div>
            </article>

            <!-- Image Article -->
            <article class="paper-article img-box">
                <div class="article-inner">
                    <h3>ç²‰ä¸åˆ›ä½œç²¾é€‰</h3>
                    <img src="assets/img/fanart/1.jpeg" alt="Fanart" style="width: 100%; margin-top: 10px; filter: sepia(0.3);">
                    <p class="caption">ç”»å¸ˆï¼šæœªçŸ¥</p>
                </div>
            </article>

            <!-- Bottom Wide Article -->
            <article class="paper-article wide-bottom">
                <div class="article-inner">
                    <h3>å…³äºæ‹›å‹Ÿ</h3>
                    <div class="cols-2">
                        <p>Aurora Project æŒç»­æ‹›å‹Ÿæœ‰æ‰åçš„åˆ›ä½œè€…åŠ å…¥ï¼æ— è®ºä½ æ˜¯ç”»å¸ˆã€å†™æ‰‹ã€è¿˜æ˜¯åƒä¼é¹…ä¸€æ ·çš„ Bug åˆ¶é€ æœºï¼ˆåˆ’æ‰ï¼‰ç¨‹åºå‘˜ï¼Œæˆ‘ä»¬éƒ½æ¬¢è¿ä½ çš„åŠ å…¥ã€‚</p>
                        <p>åŠ å…¥æ–¹å¼è¯·ç‚¹å‡»ç½‘ç«™å³ä¸Šè§’çš„â€œJOINâ€æŒ‰é’®ï¼Œæˆ–ç›´æ¥æ‰«æå®£ä¼ äºŒç»´ç ã€‚è®©æˆ‘ä»¬ä¸€èµ·ä¸ºèˆ’è‹’åˆ›é€ æ›´å¤šç¾å¥½çš„å›å¿†å§ï¼</p>
                    </div>
                </div>
            </article>

            <!-- Advertisement Parody -->
            <article class="paper-article ad-box">
                <div class="article-inner" style="border: 2px dashed #000; padding: 10px; text-align: center;">
                    <h4>å¹¿å‘Šä½æ‹›ç§Ÿ</h4>
                    <p>è¿™é‡Œå¯ä»¥æ”¾ä½ çš„ OC å¹¿å‘Šï¼</p>
                    <small>è”ç³»ä¼é¹… (QQ: 2815918449)</small>
                </div>
            </article>

        </div>

        <footer class="paper-footer">
            Aurora Daily &copy; 2026 Aurora Project | ç¼–è¾‘ï¼šä¼åˆ’ç»„ | å°åˆ·ï¼šç½‘é¡µæ¸²æŸ“å¼•æ“
        </footer>
    </div>

    <script>
        // Sidebar Logic
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar-overlay');
            sidebar.classList.toggle('active');
        }

        function handleFanartSubmit(e) {
            e.preventDefault();
            
            const btn = e.target.querySelector('.submit-btn');
            const fileInput = e.target.querySelector('input[type="file"]');
            const originalText = btn.innerText;
            
            if (!fileInput.files || fileInput.files.length === 0) {
                alert('è¯·é€‰æ‹©ä¸€å¼ å›¾ç‰‡ / Please select an image.');
                return;
            }

            const file = fileInput.files[0];
            // 1. Convert file to Base64 to send via JSON (more reliable for Netlify Functions)
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function() {
                const base64Data = reader.result.split(',')[1]; // Remove "data:image/png;base64," prefix

                // Using Cloudflare Pages Functions
                fetch(CONFIG.getApiBaseUrl() + '/api/upload', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        image: base64Data,
                        filename: file.name
                    })
                })
                .then(response => {
                return response.text().then(text => {
                    if (response.ok) {
                        try { return JSON.parse(text); } 
                        catch (e) { return { src: text }; }
                    }
                    try {
                        const errData = JSON.parse(text);
                        throw new Error(errData.message || errData.error || text);
                    } catch (e) {
                        throw new Error(text || response.statusText);
                    }
                });
            })
            .then(data => {
                console.log('Upload success:', data);
                btn.innerText = 'SUCCESS!';
                btn.style.background = '#000';
                
                // Get URL from Catbox response structure
                const imgUrl = data.url || data.src || (typeof data === 'string' ? data : 'Unknown URL');

                // Create success view
                const sidebarContent = document.querySelector('.sidebar-content');
                sidebarContent.innerHTML = `
                    <div style="text-align: center;">
                        <h3 style="margin-bottom: 20px;">ä¸Šä¼ æˆåŠŸ / UPLOADED</h3>
                        <img src="${imgUrl}" style="width: 100%; border: 2px solid #000; margin-bottom: 20px; box-shadow: 5px 5px 0 rgba(0,0,0,0.1);">
                        
                        <p style="text-align: left; font-weight: bold; margin-bottom: 5px;">å›¾ç‰‡é“¾æ¥ / URL:</p>
                        <input type="text" value="${imgUrl}" style="width: 100%; padding: 10px; margin-bottom: 20px; border: 2px solid #000;" readonly onclick="this.select()">
                        
                        <p style="text-align: left; font-weight: bold; margin-bottom: 5px;">åµŒå…¥ä»£ç  / Embed Code:</p>
                        <textarea style="width: 100%; height: 100px; padding: 10px; border: 2px solid #000; font-family: monospace;" readonly onclick="this.select()">&lt;div class="gallery-item"&gt;
    &lt;img src="${imgUrl}" alt="Fanart" loading="lazy"&gt;
    &lt;div style="padding: 15px; background: #fff; border-top: 2px solid #000;"&gt;
        &lt;span style="font-weight: 700; font-size: 0.9rem;"&gt;FANART&lt;/span&gt;
    &lt;/div&gt;
&lt;/div&gt;</textarea>
                        
                        <button onclick="location.reload()" class="submit-btn" style="margin-top: 20px;">è¿”å› / BACK</button>
                    </div>
                `;
            })
            .catch(error => {
                console.error('Error:', error);
                btn.innerText = 'FAILED';
                btn.style.background = 'red';
                alert('ä¸Šä¼ å¤±è´¥ / Upload Failed:\n' + error.message);
                
                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.disabled = false;
                    btn.style.background = '';
                }, 1000);
            });
            }; // End reader.onload
            reader.onerror = function(error) {
                console.error('Error reading file:', error);
                alert('è¯»å–æ–‡ä»¶å¤±è´¥ / File read error');
            };
        }
    </script>

    <script>
        (function() {
            const currentHost = window.location.hostname;
            const cfHost = 'aurora-project.pages.dev';
            const appHost = 'helloroom123-github-io.vercel.app';
            
            // ... routing logic ...
        })();
    </script>
    <!-- Security Layer -->
    <script src="assets/js/security.js"></script>
    <!-- <script src="http://43.225.157.187:5000/static/tracker.js" data-site="aurora-news"></script> -->
</body>
</html>